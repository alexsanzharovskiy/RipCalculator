# RtpCalculator (C++ / PHP) can be used to generate probabilities for online-slots
It will generate float probabilities, which can be used for online slot games.
To be able to control payouts without storing data, of previous WINNING / LOSES.
Which is required for games to have certification.

* Require: [WinRangesGenerator](https://github.com/alexsanzharovskiy/WinRangesGeneator)

### It's using genetic algorithm to generate probabilities.

------------------


|  Value |  Description | Variable name |
|---|---|---|
|  95.5 |  RTP value, return to player percent | $rtp |
| win_ranges.json | JSON File which is generated by [WinRangesGenerator](https://github.com/alexsanzharovskiy/WinRangesGeneator) | $winRanges |


------

### C++ Usage

1) Compilation : 
   1) ```g++ -std=c++17 -o RtpCalculator RtpCalculator.cpp```
2) Genaration RPT file:
   1) ```./RtpCalculator 95.5 win_ranges.json```

----------

### PHP usage
```php 
<?php

$service = new RtpCalculator(
    $rtp
);

$service->generate($winRanges);
```

--------------
### As result you will have generated file probabilities:
```json
[
    0.34747990969896114,
    0.03461976167105366,
    0.1473026792698089,
    0.35767122805442714,
    8.282735346604586e-5,
    5.959024604769836e-5,
    0.04756499137076591,
    ......
]
```

### PHP Usage of probabilities

```php
<?php
class Game {
    private $probabilites;
    private $combinations;
    private $cumulativeProbabilities;

    public function __construct($combinations, $probabilites) {
        $this->combinations = $combinations;
        $this->probabilites = $probabilites;
        $this->initializeCumulativeProbabilities();
    }

    private function initializeCumulativeProbabilities() {
        $this->cumulativeProbabilities = [];
        $cumulativeSum = 0;
        foreach ($this->probabilites as $probability) {
            $cumulativeSum += $probability;
            $this->cumulativeProbabilities[] = $cumulativeSum;
        }
    }

    public function play($betSize) {
        $combinations = $this->combinations;
        $randomNumber = mt_rand() / mt_getrandmax();
        $totalPayout = 0;

        foreach ($this->cumulativeProbabilities as $index => $cumulativeProbability) {
            if ($randomNumber < $cumulativeProbability) {
                $totalPayout += $combinations[$index]['payout'] * $betSize;
                break;
            }
        }

        return $totalPayout;
    }
}


$game = new Game(
        json_decode(file_get_contents('win_ranges.json'), true),
        json_decode(file_get_contents('rtp_probabilities.json'), true)
    );

$totalBets = 0;
$totalWin = 0;
$maxBetSize = 100;

for ($i = 0; $i < 1000000; $i++) {
    $betSize = 10;
    $totalBets += $betSize;
    $win = $game->play($betSize);
    $totalWin += $win;
}

$rtp = ($totalWin / $totalBets) * 100;

echo "Total bets: $totalBets\n";
echo "Total win: $totalWin\n";
echo "RTP: $rtp%\n";

```

----------------
### C++ Usage of probabilities

```cpp

#include <iostream>
#include <vector>
#include <fstream>
#include <random>
#include <nlohmann/json.hpp> // Json lib including

using json = nlohmann::json;

class Game {
private:
    std::vector<double> probabilities;
    std::vector<json> combinations;
    std::vector<double> cumulativeProbabilities;

public:
    Game(const std::vector<json>& comb, const std::vector<double>& prob) {
        combinations = comb;
        probabilities = prob;
        initializeCumulativeProbabilities();
    }

    void initializeCumulativeProbabilities() {
        cumulativeProbabilities.clear();
        double cumulativeSum = 0;
        for (double probability : probabilities) {
            cumulativeSum += probability;
            cumulativeProbabilities.push_back(cumulativeSum);
        }
    }

    double play(double betSize) {
        std::random_device rd;
        std::mt19937 gen(rd());
        std::uniform_real_distribution<> dis(0.0, 1.0);

        double randomNumber = dis(gen);
        double totalPayout = 0;

        for (size_t i = 0; i < cumulativeProbabilities.size(); ++i) {
            if (randomNumber < cumulativeProbabilities[i]) {
                totalPayout += combinations[i]["payout"].get<double>() * betSize;
                break;
            }
        }

        return totalPayout;
    }
};

std::vector<json> loadJsonFile(const std::string& filename) {
    std::ifstream file(filename);
    json j;
    file >> j;
    return j;
}

int main() {
    std::vector<json> combinations = loadJsonFile("win_ranges.json");
    std::vector<double> probabilities = loadJsonFile("rtp_probabilities.json");

    Game game(combinations, probabilities);

    double totalBets = 0;
    double totalWin = 0;
    double maxBetSize = 100;

    for (int i = 0; i < 1000000; ++i) {
        double betSize = 10;
        totalBets += betSize;
        double win = game.play(betSize);
        totalWin += win;
    }

    double rtp = (totalWin / totalBets) * 100;

    std::cout << "Total bets: " << totalBets << "\n";
    std::cout << "Total win: " << totalWin << "\n";
    std::cout << "RTP: " << rtp << "%\n";

    return 0;
}

```



# Usage result

```shell
1 Milion bets
Total bets: 10000000 Total win: 9552367.5 RTP: 95.523675%
```

